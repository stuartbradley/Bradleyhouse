@page "/ShoppingLists"
@using BradleyHouse.Data.Models.MealPrep
@using Microsoft.EntityFrameworkCore
@using Weekly_Shopping.Data

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge">
        <MudGrid Spacing="2">

        @foreach(var list in _shoppingLists.OrderByDescending(x => x.DateCreated))
        {
        <MudItem Class="d-flex justify-center">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                            <MudText Align="Align.Center" Typo="Typo.body1">@list.DateCreated.ToShortDateString()</MudText>
                    </CardHeaderContent>
                        <CardHeaderActions>
                            <MudIconButton Icon="@Icons.Material.Filled.ArrowForwardIos" OnClick="() => shoppingListSelected(list.Id)" Color="Color.Primary" Size="Size.Large" />
                        </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                <MudList>
                @foreach(var meal in list.Meals)
                {
                    <MudListItem Text="@GetMealName(meal.MealId)" Icon="@Icons.Custom.Uncategorized.FoodApple" />
                }
                </MudList>
            </MudCardContent>
            </MudCard>
        </MudItem>
        }    
        </MudGrid>
</MudContainer>


@code {
    [Inject]
    MealPlannerContext MealPlannerContext{ get; set; }

    private List<ShoppingList> _shoppingLists = new();

    [Inject]
    NavigationManager Navigation { get; set; }


    protected async override Task OnInitializedAsync()
    {
        _shoppingLists = await MealPlannerContext.ShoppingList.Include(x => x.Meals).ToListAsync();
    }

    private void shoppingListSelected(int id)
    {
        Navigation.NavigateTo($"ShoppingList/{id}");
    }

    private string GetMealName(int id)
    {
        return MealPlannerContext.Meals.Single(x => x.Id == id).Name;
    }


}
